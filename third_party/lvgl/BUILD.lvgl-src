package(default_visibility = ["//visibility:private"])

cc_library(
    name = "lvgl_top_headers",
    hdrs = [
        "lvgl.h",
        "src/lv_api_map.h",
        "src/lvgl.h",
    ],
)

cc_library(
    name = "lvgl",
    visibility = ["//visibility:public"],
    deps = [
        ":lvgl_no_drivers",
    ] + select({
        ":disable_lv_drivers": [],
        "//conditions:default": [
            # TODO: allow selecting which drivers to include
            # that's important because sdl and sdl_gpu cannot be compiled at the same time
            # (they check config values and #error out in their headers)
            "@lv_drivers//:sdl",
            #"@lv_drivers//:sdl_gpu",
            "@lv_drivers//:indev",
        ],
    }),
)

cc_library(
    name = "lvgl_no_drivers",
    hdrs = [
        "lvgl.h",
    ],
    include_prefix = "lvgl",
    visibility = ["@lv_drivers//:__subpackages__"],
    deps = [
        ":all_modules",
    ],
)

cc_library(
    name = "lv_conf_internal",
    srcs = [
        "src/lv_conf_kconfig.h",
    ],
    hdrs = [
        "src/lv_conf_internal.h",
    ],
    deps = [
        ":lv_conf",
    ],
)

cc_library(
    name = "all_modules",
    srcs = glob([
        "src/*/**/*.c",
        "src/*/**/*.h",
    ]),
    hdrs = glob([
        "src/*/**/*.h",
    ]),
    defines = {
        "LV_CONF_INCLUDE_SIMPLE": "1",
    },
    visibility = ["@lv_drivers//:__subpackages__"],
    deps = [
        ":lv_conf_internal",
        ":lvgl_top_headers",
    ],
    strip_include_prefix = "/src",
    include_prefix = "lvgl",
)

label_setting(
    name = "lv_conf",
    build_setting_default = ":lv_conf_none",
)

label_setting(
    name = "lv_drv_conf",
    build_setting_default = ":lv_drv_conf_none",
    visibility = ["@lv_drivers//:__subpackages__"],
)

config_setting(
    name = "disable_lv_drivers",
    flag_values = {
        ":lv_drv_conf": ":lv_drv_conf_none",
    },
)

cc_library(
    name = "lv_conf_none",
    # TODO: maybe provide a dummy config just so this stuff compiles without configuration?
)

cc_library(
    name = "lv_drv_conf_none",
    visibility = ["//visibility:public"],
    # TODO: maybe provide a dummy config just so this stuff compiles without configuration?
)
